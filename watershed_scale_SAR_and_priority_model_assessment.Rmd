---
title: "Watershed-scale Analysis of SAR and High-Priority Waterbodies"
author: "Chris Madsen and John Phelan"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(sf)
library(viridis)
library(bcdata)
library(bcmaps)
library(raster)
library(geodata)
```

# This is a BIG TITLE.

## Datasets

```{r reading_in_data}
# Zebra Quagga Prioritization Model
zqpm <-read_sf("./data/Waterbodies_with_binned_and_original_values.gpkg")

# Watersheds of some scale
if(!file.exists('data/watershed_groups.gpkg')){
  ws = bcdc_query_geodata('freshwater-atlas-watershed-groups') |>  # This one has 246 rows
    collect()
  sf::write_sf('data/watershed_groups.gpkg')} else {
    ws = sf::read_sf('data/watershed_groups.gpkg')
  }

# Regions (just in case)
regs = bcmaps::nr_regions()

# species-at-risk
sara = read_sf("data/dfo_sara_in_col_fras_priority_area.gpkg")

#tmax<-getData('CMIP6', var='tmax', res=10, rcp=85, model='AC', year=70)
bioclim<-worldclim_global(var="bio", res=10, path = "./data") # gets all variables - what they are https://www.worldclim.org/data/bioclim.html
plot(bioclim)# have a look
names(bioclim)# whats the name?

cmidata<-cmip6_world("ACCESS-CM2", ssp = "585", var = "bioc", res = 10, time = "2021-2040",path="./data/CMI/")

plot(cmidata$bio01)


```

```{r}
data1 |> 
  sf::st_drop_geometry() |> 
  ggplot() + 
  geom_histogram(aes(TotalInspections))
```

```{r}
head(data1)

summary(data1$TotalInspections)

data_sub<-data1[data1$TotalInspections >= 1000,]

plot1<-ggplot()+
  geom_sf(data = data_sub, aes(fill = TotalInspections)) +
  plot1+scale_fill_viridis_c(option = "plasma")

plot1
```

